# ドキュメント指向DBとリレーショナルDBの使い分け

データモデルの観点から、ドキュメント指向DBとリレーショナルDBのどちらを使うべきか説明する。

## 結論

- 多対多の関係を持つデータを扱うのであれば、リレーショナルDBを使う。
- 一対多の関係だけしかないなら、ドキュメント指向が適している。

## ドキュメント指向DBで扱いづらい例

LinkedInのようなシステムを例として考える。
ユーザーは複数の組織に所属した事があり、また組織には所属している/していたユーザーがいる。
このような場合、ユーザーと組織は多対多の関係がある。

このデータを以下のように表現したとしよう。

```json:ユーザーUser1のデータ
{
  'id': 'u1111',
  'name': 'User1',
  'orgIds': ['o1111'],
}
```

```json:組織のデータ
{
	'id': 'o1111',
	'name': 'Org1',
	'userIds': ['u1111'],
}
```

この場合、以下のような問題が発生する。
- User1が新しく別の組織Org2に参加した場合、Org2のuserIdsとUser1のorgIdsの整合性が失われないようにコードを書く必要がある。
- User1を削除した場合も、整合性を維持するようにOrg1,Org2からUser1のIDを削除しなければならない。

このように、ドキュメント指向DBで多対多の関係を表現した場合、データの整合性が失われないように注意してコードを書かなければならない。

## 参考文献
- [データ指向アプリケーションデザイン P35 2.1.3 多対一と多対多の関係](https://www.oreilly.co.jp/books/9784873118703/)

